# 🎓 AI互动讲解功能使用指南

## 📋 功能概述

DeepNote智能错题本新增了**AI互动讲解**功能，支持文字和语音两种方式与AI老师进行多轮对话，深度理解错题知识点。

## ✨ 核心特性

### 1️⃣ 双模式交互
- **文字模式**：打字提问，适合需要精确表达的场景
- **语音模式**：语音输入，解放双手，更自然的交流方式

### 2️⃣ 智能语音回复
- **可选择语音输出**：AI回复可自动转语音播放
- **一键切换**：随时开启/关闭语音回复
- **支持暂停**：播放中可随时暂停或继续

### 3️⃣ 上下文记忆
- **多轮对话**：AI记住之前的对话内容
- **深度追问**：可以针对某个知识点反复提问
- **个性化讲解**：根据你的理解程度调整讲解方式

---

## 🚀 快速开始

### 第一步：进入错题详情
在错题列表中点击任意错题，进入错题详情页面

### 第二步：点击"向AI提问"
在页面底部找到 **💬 向AI提问** 按钮，点击进入AI对话界面

### 第三步：开始提问
- **文字提问**：输入框输入问题，点击发送
- **语音提问**：点击🎤图标切换到语音模式，按住说话

---

## 💬 使用场景示例

### 场景1：不理解解题步骤
```
👤 学生: "这道题的第二步我不理解"
🤖 AI: "好的，第二步是因式分解。我们把 x² + 2x - 3 分解成 (x+3)(x-1)..."

👤 学生: "为什么可以这样分解？"
🤖 AI: "因为我们要找两个数，它们的乘积是-3，和是2..."
```

### 场景2：概念不清楚
```
👤 学生: "什么是因式分解？"
🤖 AI: "因式分解就是把一个多项式写成几个因式相乘的形式..."

👤 学生: "能举个生活中的例子吗？"
🤖 AI: "当然！就像把12分解成3×4，或者2×6..."
```

### 场景3：举一反三
```
👤 学生: "这道题掌握了，有类似的题吗？"
🤖 AI: "很好！类似的题目特点是：都涉及一元二次方程求根..."
```

---

## 🎙️ 语音功能使用

### 语音提问
1. 点击输入框右侧的 **🎤 麦克风图标**
2. 按住中间的**紫色按钮**开始说话
3. 松开按钮自动识别并发送

**提示**：
- 录音时长：最长60秒
- 最短时长：0.5秒（太短会提示重录）
- 录音权限：首次使用需授权

### 语音回复
1. 打开页面顶部的**"语音回复"开关**
2. AI的回复会自动转为语音播放
3. 点击消息旁的 **🔊 播放按钮** 可重复播放

**控制选项**：
- ⏸️ 暂停播放
- ▶️ 继续播放
- 🔇 关闭语音输出（仅文字显示）

---

## 📊 技术架构

### 云函数说明

#### 1. speechToText（语音识别）
- **功能**：将录音文件转为文字
- **技术**：腾讯云ASR语音识别
- **支持格式**：mp3, wav, pcm, aac
- **识别精度**：95%+（标准普通话）

#### 2. textToSpeech（文字转语音）
- **功能**：将AI回复转为语音
- **技术**：腾讯云TTS语音合成
- **音色**：智瑜（温柔女声）
- **语速**：标准速度

#### 3. chatWithAI（AI对话）
- **功能**：处理多轮对话逻辑
- **模型**：DeepSeek-Chat
- **上下文**：保留最近10轮对话
- **特点**：记忆题目信息，提供针对性讲解

### 数据结构

错题集合新增字段：
```javascript
{
  chatHistory: [  // 对话历史
    {
      role: 'user',           // 用户消息
      content: '问题内容',
      timestamp: Date,
      hasVoice: false
    },
    {
      role: 'assistant',      // AI回复
      content: 'AI回复内容',
      voiceFileID: 'xxx',     // 语音文件ID（可选）
      hasVoice: true,
      timestamp: Date
    }
  ]
}
```

---

## 💰 成本说明

### DeepSeek API
- **输入**：¥1/百万tokens
- **输出**：¥2/百万tokens

### 腾讯云语音服务
#### ASR 语音识别
- **免费额度**：每月1000次
- **收费**：超出后 ¥0.02/次

#### TTS 文字转语音
- **免费额度**：每月1000次
- **收费**：超出后 ¥0.02/次

### 单次对话成本估算
假设对话3轮：
- DeepSeek: ¥0.006
- ASR（语音提问）: ¥0.06
- TTS（语音回复）: ¥0.06
- **总计**: ¥0.126/题 ≈ 1毛钱

**月度成本**（1000学生，每人每天3题）：
- 纯文字模式：¥540/月
- 混合模式：¥3780/月
- 纯语音模式：¥5400/月

---

## 🔧 部署步骤

### 1. 部署云函数

```bash
# 进入云函数目录
cd cloudfunctions

# 部署语音识别
cd speechToText
npm install
# 在云开发控制台上传部署

# 部署文字转语音
cd ../textToSpeech
npm install
# 在云开发控制台上传部署

# 部署AI对话
cd ../chatWithAI
npm install
# 在云开发控制台上传部署
```

### 2. 配置环境变量

在云开发控制台 → 环境 → 设置 → 环境变量中添加：

```
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxx
```

### 3. 开通语音服务

**方式一：通过云开发控制台**
1. 进入云开发控制台
2. 扩展能力 → AI能力
3. 开通"语音识别"和"语音合成"

**方式二：通过腾讯云控制台**
1. 登录[腾讯云控制台](https://console.cloud.tencent.com/)
2. 搜索"语音识别"开通服务
3. 搜索"语音合成"开通服务

### 4. 配置小程序权限

在 `app.json` 中添加：
```json
{
  "permission": {
    "scope.record": {
      "desc": "需要使用你的麦克风进行语音提问"
    }
  }
}
```

---

## ❓ 常见问题

### Q1: 语音识别不准确？
**A**:
- 确保周围环境安静
- 说话清晰，语速适中
- 普通话识别率最高
- 避免方言和专业术语

### Q2: 无法录音？
**A**:
- 检查是否授权了录音权限
- 设置 → 隐私 → 麦克风 → 开启

### Q3: AI回复太慢？
**A**:
- 关闭"语音回复"可加快响应速度
- 网络不佳时优先使用文字模式
- 对话历史过长会影响速度，可以退出重新进入

### Q4: 语音播放失败？
**A**:
- 检查网络连接
- 确认已开启语音输出开关
- 尝试重新点击播放按钮

### Q5: 对话记录会保存吗？
**A**:
- 会自动保存在云端
- 每道题保留最近10轮对话
- 退出页面后重新进入可继续之前的对话

---

## 🎯 最佳实践

### 提问技巧
1. **具体明确**："第二步的因式分解不懂" 比 "不会做" 更好
2. **逐步深入**：先问整体思路，再问细节
3. **举一反三**：理解后可以问类似题目

### 使用建议
1. **初次学习**：建议使用文字模式，便于反复查看
2. **复习巩固**：使用语音模式，更接近真实对话
3. **碎片时间**：语音模式适合通勤、睡前等场景

### 效率优化
1. **关键时刻开启语音**：不是每次都需要语音回复
2. **保持对话简洁**：避免一次性问太多问题
3. **及时标记掌握**：理解后标记"已掌握"，避免重复

---

## 🔮 未来规划

- [ ] 支持语音实时流式回复
- [ ] 多种音色选择（男声/女声/童声）
- [ ] 语速调节
- [ ] 支持方言识别
- [ ] AI主动提问引导学习
- [ ] 错题知识图谱可视化
- [ ] 学习轨迹分析

---

## 📞 技术支持

如有问题，欢迎反馈：
- 小程序内：我的 → 帮助与反馈
- GitHub: [提交Issue](https://github.com/your-repo/issues)

---

**版本**: v1.0.0
**更新时间**: 2025-10-31
**作者**: DeepNote Team
