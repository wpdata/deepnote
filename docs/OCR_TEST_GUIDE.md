# OCR 功能测试指南

## 📱 测试环境说明

### 开发者工具测试
- **拍照识别**：会打开文件浏览器（这是正常的）
- **从相册选择**：同样打开文件浏览器
- **原因**：电脑无法调用真实摄像头，所以用文件浏览器模拟

### 真机测试
- **拍照识别**：打开手机相机真实拍照
- **从相册选择**：打开手机相册选择图片
- **体验**：完整的拍照识别流程

## 🧪 开发者工具测试步骤

### 1. 准备测试图片

您需要准备一些包含文字的图片，推荐：

**选项 A：使用示例图片**
- 从网上下载一些题目图片
- 例如：数学题、英语题等

**选项 B：自己创建测试图片**
- 截图一段文字
- 保存一张清晰的题目照片

**图片要求：**
- ✅ 格式：JPG、PNG
- ✅ 文字清晰
- ✅ 光线充足
- ✅ 大小：< 10MB

### 2. 在开发者工具中测试

**步骤：**
```
1. 打开微信开发者工具
2. 点击"拍题"标签页（底部导航栏）
3. 点击"拍照识别"按钮
4. 在弹出的文件浏览器中选择准备好的图片
5. 等待上传和识别（会显示进度条）
6. 查看识别结果
```

**观察重点：**
- 识别进度是否正常显示（0% → 100%）
- 识别结果是否准确
- 控制台是否有错误信息

### 3. 查看控制台日志

在开发者工具底部的"控制台"标签中，应该看到：

```javascript
// 1. 图片上传成功
图片上传成功 cloud://deepnote-3g0lr0fb3ce6ea1c-1365273503.xxxx.jpg

// 2. OCR识别成功
OCR识别成功 {
  success: true,
  text: "这里是识别出的文字内容...",
  confidence: 0.98,        // 识别置信度
  wordCount: 120,          // 字数统计
  service: "tencent-ocr"   // ← 重要！确认使用真实OCR
}
```

**判断标准：**
- ✅ `service: "tencent-ocr"` - 使用真实腾讯云 OCR
- ❌ `service: "mock"` - 使用模拟数据（密钥未配置）

### 4. 测试识别准确性

**测试内容：**
```
题目：已知函数 f(x) = x² + 2x - 3，求函数的零点。

解：令 f(x) = 0
x² + 2x - 3 = 0
(x + 3)(x - 1) = 0
所以 x = -3 或 x = 1
```

**检查项：**
- [ ] 公式符号是否正确（x²、=、-）
- [ ] 数字是否准确
- [ ] 文字是否完整
- [ ] 换行是否合理

### 5. 测试编辑和保存功能

**步骤：**
```
1. 识别完成后，点击"编辑"按钮
2. 修改识别结果（如有错误）
3. 选择学科（如：数学）
4. 输入知识点（如：二次函数）
5. 点击"确认添加"
6. 等待保存成功提示
7. 自动跳转到错题本页面
8. 在错题本中查看刚保存的题目
```

## 📱 真机测试步骤

### 1. 生成预览码

在开发者工具中：
```
1. 点击顶部"预览"按钮
2. 等待生成预览二维码
3. 用微信扫描二维码
4. 在手机上打开小程序
```

### 2. 在手机上测试

**拍照识别：**
```
1. 进入"拍题"页面
2. 点击"拍照识别"
3. 对准一道题目拍照
4. 等待识别完成
5. 查看识别结果
```

**从相册选择：**
```
1. 进入"拍题"页面
2. 点击"从相册选择"
3. 选择手机相册中的题目图片
4. 等待识别完成
5. 查看识别结果
```

### 3. 测试拍照技巧

**好的拍照方式：**
- ✅ 光线充足
- ✅ 对焦清晰
- ✅ 垂直拍摄
- ✅ 题目完整
- ✅ 背景简洁

**不好的拍照方式：**
- ❌ 光线不足
- ❌ 照片模糊
- ❌ 角度倾斜
- ❌ 有反光
- ❌ 背景杂乱

## 🐛 常见问题

### 问题1：识别结果是固定的几句话

**原因**：使用了模拟数据，密钥未配置或配置错误

**解决**：
1. 检查云函数环境变量是否正确配置
2. 确认密钥有效性
3. 重新部署云函数

**检查方法**：
```javascript
// 查看控制台日志
console.log(res.result.service)
// 如果是 "mock" 说明使用模拟数据
// 如果是 "tencent-ocr" 说明使用真实接口
```

### 问题2：识别失败或报错

**可能原因：**
- 网络问题
- 图片格式不支持
- 文件过大
- OCR服务未开通
- 密钥配置错误

**解决方法：**
1. 检查网络连接
2. 确认图片格式（JPG/PNG）
3. 检查图片大小（< 10MB）
4. 查看云函数日志
5. 验证密钥是否有效

### 问题3：识别准确率低

**优化方法：**
- 使用高清晰度图片
- 确保光线充足
- 垂直拍摄
- 避免反光
- 文字尽量大

### 问题4：识别速度慢

**原因：**
- 图片文件较大
- 网络速度慢
- 首次调用需要冷启动

**优化：**
- 压缩图片
- 优化网络环境
- 提前预热云函数

## 📊 测试检查清单

### 开发者工具测试
- [ ] 能打开文件浏览器选择图片
- [ ] 图片上传成功
- [ ] 识别进度正常显示
- [ ] 识别结果准确
- [ ] service 字段为 "tencent-ocr"
- [ ] 可以编辑识别结果
- [ ] 可以选择学科和知识点
- [ ] 可以保存到错题本
- [ ] 错题本中能看到保存的题目

### 真机测试
- [ ] 能打开相机拍照
- [ ] 能选择相册图片
- [ ] 拍照功能正常
- [ ] 识别速度可接受
- [ ] 识别结果准确
- [ ] 整体流程流畅

## 💡 测试建议

### 测试用例

**用例1：简单文字**
```
测试内容：1 + 1 = 2
预期结果：准确识别数字和符号
```

**用例2：数学公式**
```
测试内容：f(x) = x² + 2x - 3
预期结果：准确识别函数和上标
```

**用例3：选择题**
```
测试内容：
题目：计算 sin 30° + cos 60° = ?
A. 0
B. 1
C. √2
D. √3
预期结果：完整识别题目和选项
```

**用例4：中英文混合**
```
测试内容：She goes to the library every weekend.
预期结果：准确识别中英文
```

### 性能测试

**指标：**
- 上传时间：< 2秒
- 识别时间：< 3秒
- 总耗时：< 5秒

**测试方法：**
```javascript
console.time('OCR识别')
// 执行识别
console.timeEnd('OCR识别')
```

## 📈 识别效果评估

### 准确率标准

- **优秀**：95%+ 准确率
- **良好**：90-95% 准确率
- **一般**：80-90% 准确率
- **需优化**：< 80% 准确率

### 影响因素

**图片质量：**
- 清晰度：高清 > 标清 > 模糊
- 光线：充足 > 正常 > 不足
- 角度：正面 > 侧面 > 倾斜

**文字类型：**
- 印刷体：识别率高
- 手写体：识别率中等
- 艺术字：识别率低

## 🎯 下一步

测试通过后，可以：
1. 优化识别准确率
2. 添加图片预处理
3. 实现批量识别
4. 集成 AI 自动分析

---

**文档版本**: v1.0
**更新日期**: 2025-10-27
