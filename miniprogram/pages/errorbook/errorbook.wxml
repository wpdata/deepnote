<scroll-view class="container" scroll-y="true" refresher-enabled="{{true}}" refresher-triggered="{{refreshing}}" bindrefresherrefresh="onPullDownRefresh" bindscrolltolower="loadMore" lower-threshold="100" enable-back-to-top="{{true}}">
  <!-- é¡¶éƒ¨ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-header">
    <view class="stat-item">
      <text class="stat-number">{{totalErrors}}</text>
      <text class="stat-label">é”™é¢˜æ€»æ•°</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{masteredErrors}}</text>
      <text class="stat-label">å·²æŒæ¡</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{unsolvedErrors}}</text>
      <text class="stat-label">å¾…å¤ä¹ </text>
    </view>
  </view>

  <!-- å­¦ç§‘æ ‡ç­¾ -->
  <view class="subject-tabs">
    <scroll-view scroll-x class="subject-scroll">
      <view
        class="subject-tag {{currentSubject === item.id ? 'active' : ''}}"
        wx:for="{{subjects}}"
        wx:key="id"
        bindtap="selectSubject"
        data-id="{{item.id}}"
      >
        {{item.name}}
      </view>
    </scroll-view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <scroll-view scroll-x class="filter-scroll">
      <view
        class="filter-tag {{currentFilter === '' ? 'active' : ''}}"
        bindtap="selectFilter"
        data-filter=""
      >
        å…¨éƒ¨
      </view>
      <view
        class="filter-tag {{currentFilter === 'favorited' ? 'active' : ''}}"
        bindtap="selectFilter"
        data-filter="favorited"
      >
        â˜… å·²æ”¶è—
      </view>
      <view
        class="filter-tag {{currentFilter === 'mastered' ? 'active' : ''}}"
        bindtap="selectFilter"
        data-filter="mastered"
      >
        âœ“ å·²æŒæ¡
      </view>
      <view
        class="filter-tag {{currentFilter === 'unmastered' ? 'active' : ''}}"
        bindtap="selectFilter"
        data-filter="unmastered"
      >
        âœ— æœªæŒæ¡
      </view>
    </scroll-view>
  </view>

  <!-- é”™é¢˜åˆ—è¡¨ -->
  <view class="error-list">
    <view
      class="error-item"
      wx:for="{{errorList}}"
      wx:key="_id"
      bindtap="goToErrorDetail"
      data-id="{{item._id}}"
    >
      <!-- é”™é¢˜å›¾ç‰‡ -->
      <image class="error-image" src="{{item.imageUrl}}" mode="aspectFill" />

      <!-- é”™é¢˜ä¿¡æ¯ -->
      <view class="error-info">
        <text class="error-content">{{item.content}}</text>
        <view class="error-meta">
          <text class="error-time">{{item.createTime}}</text>
          <view class="error-tags">
            <text wx:if="{{item.mastered}}" class="tag tag-mastered">å·²æŒæ¡</text>
            <text wx:if="{{item.difficulty}}" class="tag tag-difficulty">{{item.difficulty}}</text>
          </view>
        </view>
      </view>

      <!-- æ”¶è—æŒ‰é’® -->
      <view class="favorite-btn" catchtap="toggleFavorite" data-id="{{item._id}}" data-favorited="{{item.favorited}}">
        <text class="favorite-icon">{{item.favorited ? 'â˜…' : 'â˜†'}}</text>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && errorList.length > 0}}">
      <text class="load-more-text">{{loadingMore ? 'åŠ è½½ä¸­...' : 'ä¸‹æ‹‰åŠ è½½æ›´å¤š'}}</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && errorList.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{errorList.length === 0 && !refreshing}}">
      <text class="empty-icon">ğŸ“š</text>
      <text class="empty-text">æš‚æ— é”™é¢˜</text>
      <text class="empty-hint">å»æ‹é¢˜é¡µé¢æ·»åŠ é”™é¢˜å§</text>
    </view>
  </view>
</scroll-view>
