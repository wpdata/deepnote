<view class="container">
  <!-- 用户信息卡片 -->
  <view class="user-card">
    <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
      <image wx:if="{{userInfo.avatarUrl}}" class="avatar-img" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
      <view wx:else class="avatar-placeholder">👤</view>
    </button>
    <view class="user-info">
      <view class="nickname-container">
        <input
          wx:if="{{isEditingNickname}}"
          class="nickname-input"
          type="nickname"
          value="{{userInfo.nickName}}"
          bindblur="onNicknameBlur"
          bindinput="onNicknameInput"
          placeholder="请输入昵称"
          auto-focus
        />
        <text wx:else class="username" bindtap="onEditNickname">{{userInfo.nickName || '点击设置昵称'}}</text>
      </view>
      <view class="user-meta">
        <text class="study-days">已学习 {{userInfo.studyDays}} 天</text>
        <text wx:if="{{userInfo.grade}}" class="grade-tag">{{userInfo.grade.displayName}}</text>
        <text wx:else class="grade-tag unset" bindtap="onChangeGrade">点击设置年级</text>
      </view>
    </view>
  </view>

  <!-- 学习数据统计 -->
  <view class="stats-card">
    <text class="card-title">学习数据</text>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalErrors}}</text>
        <text class="stat-label">错题总数</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.masteredErrors}}</text>
        <text class="stat-label">已掌握</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.practiceCount}}</text>
        <text class="stat-label">练习次数</text>
      </view>
    </view>

    <view class="progress-section">
      <view class="progress-header">
        <text class="progress-label">总体掌握率</text>
        <text class="progress-value">{{stats.masteredRate}}%</text>
      </view>
      <view class="progress-bar-bg">
        <view class="progress-bar" style="width: {{stats.masteredRate}}%"></view>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-item" bindtap="onChangeGrade">
      <view class="menu-left">
        <view class="menu-icon">🎓</view>
        <text class="menu-title">年级设置</text>
      </view>
      <view class="menu-right">
        <text class="menu-value">{{userInfo.grade ? userInfo.grade.displayName : '未设置'}}</text>
        <text class="arrow-icon">›</text>
      </view>
    </view>

    <view class="menu-item" bindtap="onFeedback">
      <view class="menu-left">
        <view class="menu-icon">💬</view>
        <text class="menu-title">帮助与反馈</text>
      </view>
      <text class="arrow-icon">›</text>
    </view>

    <view class="menu-item" bindtap="onAbout">
      <view class="menu-left">
        <view class="menu-icon">ℹ️</view>
        <text class="menu-title">关于我们</text>
      </view>
      <text class="arrow-icon">›</text>
    </view>
  </view>

  <!-- 版本信息 -->
  <view class="version-info">
    <text class="version-text">版本 2.0.3</text>
  </view>
</view>
