<view class="container">
  <!-- 题目信息卡片 -->
  <view class="question-card">
    <view class="question-header">
      <view class="subject-tag">{{question.subject}}</view>
      <view class="knowledge-tag">{{question.knowledgePoint}}</view>
      <view class="difficulty-tag difficulty-{{question.difficulty}}">
        {{question.difficulty === 'easy' ? '简单' : question.difficulty === 'hard' ? '困难' : '中等'}}
      </view>
      <view class="mastered-status {{question.mastered ? 'mastered' : ''}}">
        {{question.mastered ? '已掌握' : '待掌握'}}
      </view>
    </view>

    <!-- 题型和练习统计 -->
    <view wx:if="{{question.questionType || question.practiceCount > 0}}" class="question-meta">
      <text wx:if="{{question.questionType}}" class="meta-item">📝 {{question.questionType}}</text>
      <text wx:if="{{question.practiceCount > 0}}" class="meta-item">
        🎯 练习 {{question.practiceCount}} 次
        <text wx:if="{{question.correctCount > 0}}" class="success-text"> (答对{{question.correctCount}}次)</text>
      </text>
    </view>

    <view class="question-content">
      <text class="content-title">题目内容</text>
      <text class="content-text">{{question.content}}</text>
    </view>

    <image wx:if="{{question.imageUrl}}" class="question-image" src="{{question.imageUrl}}" mode="widthFix"></image>
  </view>

  <!-- 答案信息卡片 -->
  <view wx:if="{{question.userAnswer || question.correctAnswer}}" class="answer-card">
    <view class="card-title">📝 答案信息</view>

    <view wx:if="{{question.userAnswer}}" class="answer-section">
      <text class="answer-label">我的答案</text>
      <text class="answer-value">{{question.userAnswer}}</text>
    </view>

    <view wx:if="{{question.correctAnswer}}" class="answer-section">
      <text class="answer-label">正确答案</text>
      <text class="answer-value correct">{{question.correctAnswer}}</text>
    </view>

    <view wx:if="{{question.isCorrect !== null}}" class="answer-section">
      <text class="answer-label">判题结果</text>
      <view class="result-tag {{question.isCorrect ? 'correct' : 'wrong'}}">
        {{question.isCorrect ? '✓ 正确' : '✗ 错误'}}
      </view>
    </view>
  </view>

  <!-- AI 分析卡片 -->
  <view class="analysis-card">
    <view class="card-title">
      <image class="ai-icon" src="/images/ai.png" mode="aspectFit"></image>
      <text>AI 智能分析 (DeepSeek)</text>
    </view>

    <view class="analysis-section">
      <text class="section-content">{{aiAnalysisText || '暂无AI分析'}}</text>
    </view>
  </view>

  <!-- 相关知识点 -->
  <view class="related-card">
    <text class="card-title">相关知识点</text>
    <view class="tag-list">
      <view class="tag-item" wx:for="{{relatedKnowledge}}" wx:key="index">
        {{item}}
      </view>
    </view>
  </view>

  <!-- 底部操作按钮 -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="startPractice">
      <image class="btn-icon" src="/images/practice.png" mode="aspectFit"></image>
      强化练习
    </button>
    <button class="action-btn primary {{question.mastered ? 'mastered' : ''}}" bindtap="toggleMastered">
      <image class="btn-icon" src="/images/{{question.mastered ? 'check' : 'uncheck'}}.png" mode="aspectFit"></image>
      {{question.mastered ? '已掌握' : '标记已掌握'}}
    </button>
  </view>
</view>
